# NIKON_RAG


è¿™æ˜¯ä¸€ä¸ªé¢å‘å°¼åº·ç›¸æœºè§„æ ¼ä¹¦ï¼ˆspecsï¼‰ä¸ç”¨æˆ·æ‰‹å†Œï¼ˆmanualï¼‰çš„ **LLM+RAG ç²¾å‡†å­—æ®µæŠ½å–**ç³»ç»Ÿã€‚  
ç‰¹ç‚¹ï¼š**æ­£åˆ™ä¼˜å…ˆã€LLM è¡¥é½ã€è¯æ®ä¸¥æ ¼å¯¹é½ã€å­—æ®µçº§åå¥½ specsã€å¯æ‰¹é‡æµ‹è¯•ä¸ç¦»çº¿è¯„æµ‹**ã€‚

ä¸ªäººå­¦ä¹ æµ‹è¯•ä½¿ç”¨ï¼Œæ— å•†ç”¨ã€‚


## ğŸ”¢ æµ‹è¯•åŸºå‡†ç»“æœ
```
Gold å­—æ®µæ•°: 75
æœ‰é¢„æµ‹å€¼å­—æ®µæ•°: 72
Coverage: 96.0%
Exact Match: 90.667%
Loose Match: 92.0%
```
> æ³¨ï¼šCoverage=å¬å›/å¡«å……èƒ½åŠ›ï¼›Exact Match=æ ‡å‡†åŒ–å®Œå…¨ä¸€è‡´ï¼›Loose Match=åŒ…å«/è¿‘ä¼¼ä¸€è‡´ã€‚


Example:
```
Q20: Z5II ä¸ Z6III çš„å­˜å‚¨ä»‹è´¨ä¸åŒå¡æ§½å·®å¼‚ï¼Ÿ

==== Answer ====
ç»“è®ºï¼šå·²åˆ—å‡ºæ‰€è¯¢å­—æ®µã€‚
| å­—æ®µ | Z6III | Z5II |
| å­˜å‚¨ä»‹è´¨ | CFexpress (Bå‹)ï¼ŒXQDï¼ŒSDï¼ŒSDHC (å…¼å®¹UHS-II) , SDXC (å…¼å®¹UHS-II)å­˜å‚¨å¡ | SDã€SDHCï¼ˆå…¼å®¹UHS-IIï¼‰ã€SDXCï¼ˆå…¼å®¹UHS-IIï¼‰ |
| åŒå¡æ§½é…ç½® | â€” | 2å¼ SDå¡ |

å¼•ç”¨ï¼š
Z6III | Nikon_Z6III_specs.pdf | p.2
Z5II | Nikon_Z5II_specs.pdf | p.2

==== Context(è¯æ®å¥å­) ====

- å­˜å‚¨ä»‹è´¨ CFexpress (Bå‹)ï¼ŒXQDï¼ŒSDï¼ŒSDHC (å…¼å®¹UHS-II) , SDXC (å…¼å®¹UHS-II)å­˜å‚¨å¡ â€”â€” å¼•ç”¨ï¼šZ6III | Nikon_Z6III_specs.pdf | p.2
- å­˜å‚¨ä»‹è´¨ SDã€SDHCï¼ˆå…¼å®¹UHS-IIï¼‰ã€SDXCï¼ˆå…¼å®¹UHS-IIï¼‰ â€”â€” å¼•ç”¨ï¼šZ5II | Nikon_Z5II_specs.pdf | p.2
- åŒå­˜å‚¨å¡æ’æ§½ 2å¼ SDå¡ â€”â€” å¼•ç”¨ï¼šZ5II | Nikon_Z5II_specs.pdf | p.2

```


## ğŸ§© æ•°æ®æ ¼å¼ï¼ˆjsonlï¼‰

`ask.py` ä¼šé€’å½’è¯»å– `*.jsonl`ï¼Œæ¯è¡Œå»ºè®®åŒ…å«ï¼š

```json
{
  "text": "æœ‰æ•ˆåƒç´ æ•° çº¦4,571ä¸‡ â€¦â€¦",
  "model": "Z8",
  "doc_type": "specs",
  "page": 2,
  "source": "Nikon_Z8_specs.pdf"
}
````

---
## ç¯å¢ƒä¸ä¾èµ–

**è¿è¡Œç¯å¢ƒ**
- Python â‰¥ 3.9  
- æœ¬åœ° **Ollama** 
- é»˜è®¤å¤§æ¨¡å‹ï¼š`qwen2.5:14b-instruct`ï¼ˆå·²åœ¨ä»£ç ä¸­è®¾ä¸ºé»˜è®¤å€¼ï¼‰


```bash
# 1. åˆ›å»ºå¹¶æ¿€æ´» conda ç¯å¢ƒï¼ˆPython 3.9ï¼‰
conda create -n nikon_rag python=3.9
conda activate nikon_rag

# 2. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 3. æœ¬åœ°å¤§æ¨¡å‹ï¼ˆOllama + Qwen2.5 14Bï¼‰
ollama pull qwen2.5:14b-instruct
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1) å•é—®é¢˜é—®ç­”ï¼ˆLLM+RAGï¼‰

```bash
python src/ask.py "Z8 ä¸ Z9 çš„åƒç´ ä¸è¿æ‹å·®å¼‚ï¼Ÿ"
```

è¾“å‡ºåŒ…å«ï¼š

* `==== Answer ====`ï¼šMarkdown è¡¨æ ¼ï¼ˆå­—æ®µ Ã— æœºå‹ï¼‰
* `==== Context(è¯æ®å¥å­) ====`ï¼šæ¯ä¸ªå€¼å¯¹åº”çš„ä¸€å¥è¯æ® + å¼•ç”¨ï¼ˆ`MODEL | SOURCE | p.PAGE`ï¼‰

### 2) æ‰¹é‡é—®ç­”ï¼ˆå†™å…¥ `outputs/qa_run.txt`ï¼‰

```bash
python src/ask.py --batch --out outputs/qa_run.txt
```

---

## ğŸ“Š è¯„æµ‹ï¼ˆCoverage / EM / Looseï¼‰

### A. ç”¨ç°æˆæ‰¹é‡ç»“æœè¯„æµ‹ï¼ˆä¸ä¼šå†æ¬¡è°ƒç”¨ LLMï¼‰

```bash
python src/ask.py --batch --out outputs/qa_run.txt
python src/eval.py --report outputs/qa_run.txt --debug
```

### B. ç”¨â€œé—®é¢˜åˆ—è¡¨æ–‡ä»¶â€åœ¨çº¿è¯„æµ‹ï¼ˆä¼šè°ƒç”¨ LLM+RAGï¼‰

```bash
# å‡†å¤‡é—®é¢˜æ–‡ä»¶ï¼šæ¯è¡Œä¸€ä¸ªé—®é¢˜
cat > tests_20.txt << 'EOF'
Z8 ä¸ Z9 çš„è§†é¢‘åˆ†è¾¨ç‡å’Œå¸§é¢‘å¯¹æ¯”ï¼Ÿ
Z6III çš„è§†é¢‘å‹ç¼©ä¸æ–‡ä»¶æ ¼å¼å„æ”¯æŒå“ªäº›ï¼Ÿ
Z5II ä¸ Z6III çš„å­˜å‚¨ä»‹è´¨ä¸åŒå¡æ§½å·®å¼‚ï¼Ÿ
Z7II çš„å–æ™¯å™¨å’Œæ˜¾ç¤ºå±è§„æ ¼æ˜¯ä»€ä¹ˆï¼Ÿ
Z8 çš„æœºèº«å°ºå¯¸ï¼ˆå®½Ã—é«˜Ã—åšï¼‰ä¸é‡é‡æ˜¯å¤šå°‘ï¼Ÿ
Z9 çš„å¿«é—¨é€Ÿåº¦èŒƒå›´ä¸é—ªå…‰åŒæ­¥é€Ÿåº¦ï¼Ÿ
Zf çš„ç…§ç‰‡æ–‡ä»¶æ ¼å¼æ˜¯å¦æ”¯æŒ HEIFï¼Ÿ
D850 ä¸ Z7II çš„æœ‰æ•ˆåƒç´ ä¸æ€»åƒç´ æœ‰ä½•ä¸åŒï¼Ÿ
Z8 çš„ RAW è§†é¢‘å¸§å°ºå¯¸ï¼ˆåƒç´ ï¼‰å’Œå¸§ç‡æœ‰å“ªäº›ï¼Ÿ
Z9 çš„ N-RAW ä¸ ProRes RAW æ˜¯å¦æ”¯æŒï¼Ÿåˆ—å‡ºå…·ä½“ç¼–ç ã€‚
Z6III ä¸ Z5II çš„æœ€é«˜è¿æ‹æ¯ç§’å¹…æ•°å¯¹æ¯”ï¼Ÿ
Z8 ä¸ Z9 çš„å­˜å‚¨å¡ç±»å‹ä¸å¡æ§½é…ç½®å·®å¼‚ï¼Ÿ
Z5II çš„è§†é¢‘ç”»é¢å°ºå¯¸ï¼ˆåƒç´ ï¼‰å’Œå¸§ç‡ï¼ˆç”¨Ã—å†™æ³•ï¼‰æœ‰å“ªäº›ï¼Ÿ
Zf çš„è¿æ‹ä¸æœ‰æ•ˆåƒç´ å¯¹æ¯” Z6IIIï¼Ÿ
Z8 çš„è§†é¢‘æ–‡ä»¶æ ¼å¼ï¼ˆå®¹å™¨ï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ
Z9 çš„æ˜¾ç¤ºå±ï¼ˆLCDï¼‰ä¸å–æ™¯å™¨ï¼ˆEVFï¼‰è¦ç‚¹ï¼Ÿ
Z6III çš„å¿«é—¨é€Ÿåº¦ä¸é—ªå…‰åŒæ­¥é€Ÿåº¦ï¼Ÿ
Z7II çš„å­˜å‚¨ä»‹è´¨ä¸åŒå­˜å‚¨å¡æ’æ§½é…ç½®ï¼Ÿ
D850 çš„è§†é¢‘åˆ†è¾¨ç‡ä¸å¸§é¢‘åˆ—è¡¨ï¼Ÿ
Z8 ä¸ Z9 çš„åƒç´ ä¸è¿æ‹è§„æ ¼å¯¹æ¯”ï¼ˆåƒç´ ã€è¿æ‹ï¼‰ï¼Ÿ
EOF

python src/eval.py --questions tests_20.txt --debug
```

è¯„æµ‹è¾“å‡ºï¼š

* `outputs/eval_metrics_YYYYMMDD-HHMMSS.json`
* `outputs/eval_errors_YYYYMMDD-HHMMSS.csv`

---

### ğŸ§  è®¾è®¡è¦ç‚¹

1. **æ­£åˆ™ä¼˜å…ˆï¼ŒLLM è¡¥å…¨**  
   é’ˆå¯¹è§„æ ¼è¡¨ä¸­æ ¼å¼ç¨³å®šçš„å­—æ®µï¼ˆåƒç´ ã€è¿æ‹ç­‰ï¼‰ï¼Œä¼˜å…ˆä½¿ç”¨ç²¾è°ƒæ­£åˆ™è¿›è¡Œç»“æ„åŒ–æŠ½å–ï¼›ä»…åœ¨æ­£åˆ™ç¼ºå¤±æ—¶ï¼Œè°ƒç”¨ LLM åœ¨æ£€ç´¢åˆ°çš„è¯æ®ç‰‡æ®µå†…åšâ€œç¼ºå£å¡«è¡¥â€ã€‚

2. **ç­”æ¡ˆâ€“è¯æ®å¼ºç»‘å®š**  
   LLM è¿”å›ç»Ÿä¸€ç»“æ„ï¼š`{"value","evidence","cite"}`ã€‚æ¡†æ¶å¯¹è¾“å‡ºåšçº¦æŸä¸æ ¡éªŒï¼š  
   - `value` å¿…é¡»æ˜¯ `evidence` çš„å­ä¸²ï¼›  
   - `cite` å¿…é¡»æ¥è‡ªå½“å‰æ£€ç´¢åˆ°çš„è¯æ®å¤´éƒ¨ã€‚  
   è¿™æ ·ä¿è¯æ¯ä¸€ä¸ªå±•ç¤ºç»™ç”¨æˆ·çš„æ•°å€¼ï¼Œéƒ½èƒ½ç›´æ¥è¿½æº¯åˆ°åŸæ–‡å‡ºå¤„ã€‚

3. **å­—æ®µçº§æ–‡æ¡£åå¥½ï¼ˆspecs ä¼˜å…ˆï¼‰**  
   å¯¹â€œæœºèº«å°ºå¯¸/é‡é‡â€ç­‰æ•°å€¼æ•æ„Ÿå­—æ®µï¼Œåœ¨æ£€ç´¢ä¸æŠ½å–é˜¶æ®µå¯¹ `doc_type == "specs"` æ–½åŠ é¢å¤–æƒé‡ï¼Œä»…åœ¨ specs ç¼ºå¤±æ—¶æ‰å›é€€åˆ° manualï¼Œå‡å°‘è¯´æ˜ä¹¦æ–‡æ¡ˆå¯¹å‚æ•°çš„å¹²æ‰°ã€‚

4. **è‡ªåŠ¨æ„é€ ã€Œé‡‘æ ‡ã€ç”¨äºè¯„æµ‹**  
   è¯„æµ‹é˜¶æ®µä¸ä¾èµ–äººå·¥æ ‡æ³¨ï¼Œè€Œæ˜¯ä»…åŸºäº specs æ–‡æ¡£ + æ­£åˆ™æŠ½å–å¾—åˆ°ä¸€ä»½â€œé‡‘æ ‡å‚æ•°è¡¨â€ï¼›æ¨¡å‹é¢„æµ‹ç»“æœæŒ‰å­—æ®µä¸é‡‘æ ‡é€é¡¹æ¯”å¯¹ï¼Œè®¡ç®— Coverage / Exact Match / Loose Match ç­‰æŒ‡æ ‡ï¼Œè¯„ä¼°æ•´ä¸ª LLM+RAG é“¾è·¯çš„å¯é æ€§ã€‚


## ğŸ“œ è®¸å¯

ä»…ä¾›å­¦ä¹ ä¸ä½œå“é›†å±•ç¤ºã€‚PDF ç‰ˆæƒå½’åŸå‡ºç‰ˆç¤¾/å°¼åº·æ‰€æœ‰ï¼Œè¯·åœ¨éµå®ˆç›¸åº”ä½¿ç”¨æ¡æ¬¾ä¸è‘—ä½œæƒæ”¿ç­–çš„å‰æä¸‹ä½¿ç”¨æœ¬é¡¹ç›®ã€‚
